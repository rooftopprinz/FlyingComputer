#!/usr/bin/python
import smbus
import time

REGDEVID       = 0x00
REGTHRESHTAP   = 0x1D
REGOFFSETX     = 0x1E
REGOFFSETY     = 0x1F
REGOFFSETZ     = 0x20
REGDURATION    = 0x21
REGTAPLATENCY  = 0x22
REGTAPWINDOW   = 0x23
REGTHRESHACT   = 0x24
REGTHRESHINACT = 0x25
REGTIMEINACT   = 0x26

REGACTINACTCTL = 0x27
ACTACDCMASK    = 0b10000000
ACTXENMASK     = 0b01000000
ACTYENMASK     = 0b00100000
ACTZENMASK     = 0b00010000
INACTACDCMASK  = 0b00001000
INACTXENMASK   = 0b00000100
INACTYENMASK   = 0b00000010
INACTZENMASK   = 0b00000001

REGTHRESHFF    = 0x28

REGTIMEFF      = 0x29

REGTAPAXES     = 0x2A
SUPRESSMASK    = 0b00001000
TAPXENMASK     = 0b00000100
TAPYENMASK     = 0b00000010
TAPZENMASK     = 0b00000001

REGACTTAPSTAT  = 0x2B
ACTXSRCMASK    = 0b01000000
ACTYSRCMASK    = 0b00100000
ACTZSRCMASK    = 0b00010000
ASLEEPMASK     = 0b00001000
TAPXSRCMASK    = 0b00000100
TAPYSRCMASK    = 0b00000010
TAPZSRCMASK    = 0b00000001

REGBWRATE      = 0x2C
LOWPOWERMASK   = 0b00010000
RATEMASK       = 0b00001111

DR_0p10HZ      = 0
DR_0p20HZ      = 1
DR_0p39HZ      = 2
DR_0p78HZ      = 3
DR_1p56HZ      = 4
DR_3p13HZ      = 5
DR_6p26HZ      = 6
DR_12p5HZ      = 7
DR_25p0HZ      = 8
DR_50p0HZ      = 9
DR_100p0HZ     = 10
DR_200p0HZ     = 11
DR_400p0HZ     = 12
DR_800p0HZ     = 13
DR_1600p0HZ    = 14
DR_3200p0H     = 15


REGPOWERCTL    = 0x2D
LINKMASK       = 0b00100000
AUTOSLEEPMASK  = 0b00010000
MEASUREMASK    = 0b00001000
SLEEPMASK      = 0b00000100
WAKEUPMASK     = 0b00000011

REGINTENABLE   = 0x2E
REGINTMAP      = 0x2F
REGINTSRC      = 0x30
DATARDYMASK    = 0b10000000
SINGLETAPMASK  = 0b01000000
DOUBLETAPMASK  = 0b00100000
ACTIVITYMASK   = 0b00010000
INACTIVITYMASK = 0b00001000
FREEFALLMASK   = 0b00000100
WATERMARKMASK  = 0b00000010
OVERRUNMASK    = 0b00000001

REGDATAFMT     = 0x31
SELFTESTMASK   = 0b10000000
SPIMASK        = 0b01000000
INTINVERTMASK  = 0b00100000
FULLRESMASK    = 0b00001000
JUSTIFYMASK    = 0b00000100
RANGEMASK      = 0b00000011
Range_2g       = 0
Range_4g       = 1
Range_8g       = 2
Range_16g      = 3

REGDATAX0      = 0x32
REGDATAX1      = 0x33
REGDATAY0      = 0x34
REGDATAY1      = 0x35
REGDATAZ0      = 0x36
REGDATAZ1      = 0x37

REGFIFOCTL     = 0x38
FIFOMODEMASK   = 0b11000000
TRIGGERMASK    = 0b00100000
SAMPLESMASK    = 0b00011111

REGFIFOSTAT    = 0x39
FIFOTRIGMASK   = 0b10000000
FIFOSZMASK     = 0b00111111

I2C_ADDR = 0x53
bus = smbus.SMBus(1)
devid = bus.read_byte_data(I2C_ADDR, 0)
print "devid:", hex(devid)
bus.write_byte_data(I2C_ADDR, REGBWRATE,   DR_12p5HZ)      # DR_100p0HZ
bus.write_byte_data(I2C_ADDR, REGPOWERCTL, MEASUREMASK)    # MEASUREMASK
bus.write_byte_data(I2C_ADDR, REGDATAFMT,  FULLRESMASK|SELFTESTMASK|Range_16g)    # FULLRESMASK
time.sleep(0.5)
tstart = time.time()
while (True):
    tnow = time.time() - tstart
    data0 = bus.read_byte_data(I2C_ADDR, REGDATAX0)
    data1 = bus.read_byte_data(I2C_ADDR, REGDATAX1)
    xAccl = (data1<<8)|data0
    data0 = bus.read_byte_data(I2C_ADDR, REGDATAY0)
    data1 = bus.read_byte_data(I2C_ADDR, REGDATAY1)
    yAccl = (data1<<8)|data0
    data0 = bus.read_byte_data(I2C_ADDR, REGDATAZ0)
    data1 = bus.read_byte_data(I2C_ADDR, REGDATAZ1)
    zAccl = (data1<<8)|data0
    print "@%lf : %s %s %s" % (tnow, hex(xAccl), hex(yAccl), hex(zAccl))
    time.sleep(0.1)
